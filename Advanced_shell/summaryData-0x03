#!/bin/bash

output_file="pokemon_report.csv"

# Write CSV header
echo "Name,Height,Weight" > "$output_file"

# Loop over all JSON files in current directory
for jsonfile in *.json; do
  name=$(jq -r '.name' "$jsonfile")
  height=$(jq -r '.height' "$jsonfile")
  weight=$(jq -r '.weight' "$jsonfile")

  echo "$name,$height,$weight" >> "$output_file"
done

echo "CSV file $output_file created."

# Use sed to clean up the CSV file (e.g., remove trailing spaces after commas)
sed -i 's/, */,/g' "$output_file"

# Use awk to calculate averages and append to the CSV file
awk -F, '
  NR > 1 {
    total_height += $2
    total_weight += $3
    count++
  }
  END {
    avg_height = total_height / count
    avg_weight = total_weight / count
    printf "\nAverage Height (m),Average Weight (kg)\n%.2f,%.2f\n", avg_height/10, avg_weight/10
  }
' "$output_file" >> "$output_file"

echo "Average height and weight appended to $output_file."
