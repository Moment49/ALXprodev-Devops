#!/bin/bash

# JSON-style Pokémon list as a string (square brackets + quotes)
pokemon_list='["bulbasaur", "ivysaur", "venusaur", "charmander", "charmeleon"]'
log_file="error_log.txt"

# Clear previous error log
> "$log_file"

# Use jq to parse the JSON array and loop through each Pokémon
for pokemon in $(echo "$pokemon_list" | jq -r '.[]'); do
  echo "Fetching data for $pokemon..."
  
  success=0
  attempts=0
  max_attempts=3

  while [[ $attempts -lt $max_attempts ]]; do
    ((attempts++))
    
    http_code=$(curl -s -w "%{http_code}" -o "$pokemon.json" "https://pokeapi.co/api/v2/pokemon/$pokemon")
    
    if [[ "$http_code" == "200" ]]; then
      echo "Saved $pokemon.json"
      success=1
      break
    else
      echo "Attempt $attempts for $pokemon failed (HTTP $http_code). Retrying..."
      sleep 2
    fi
  done

  if [[ $success -ne 1 ]]; then
    echo "Failed to fetch data for $pokemon after $max_attempts attempts." | tee -a "$log_file"
    [[ -f "$pokemon.json" ]] && rm "$pokemon.json"
  fi

  sleep 2
done

echo "All done! Errors logged in $log_file (if any)."
